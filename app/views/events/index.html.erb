<%# the filter js function will use jQuery at the moment%>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
<script src="https://unpkg.com/isotope-layout@3/dist/isotope.pkgd.min.js"></script>

<div class="container align-items-right" style="box-shadow: none !important;">
  <div class="row align-items-right">
    <div class="col-lg-12">

<h2>Currently you have <%= Event.count %> events managed at Syncsparkle.</h2>
<h3>Total views: 653 (sum of all views)</h2>
<h3>Your are posting across 14 platforms (sum of all platforms)</h2>
<p><%= pluralize(@past_events_count, 'event') %> ended.</p>



<button id="filter-all">Show All Events</button>
<button id="filter-upcoming">Show Upcoming Events</button>
<button id="filter-past">Show Past Events</button>


<%# # filter can be set by category %>
      <ul class="filters category">
        <li class="active" data-filter="*"><a href="#!">All</a></li>
        <li data-filter=".Food"><a href="#!">Food</a></li>
        <li data-filter=".Sport"><a href="#!">Sport</a></li>
        <li data-filter=".Concert"><a href="#!">Concert</a></li>
        <li data-filter=".Business"><a href="#!">Business</a></li>
      </ul>

      <ul class="filters online-offline">
        <li class="active" data-filter="*"><a href="#!">All</a></li>
        <li data-filter=".yes"><a href="#!">Online Event</a></li>
        <li data-filter=".no"><a href="#!">Offline Event</a></li>
      </ul>

        <div class="container align-items-right" style="box-shadow: none !important;">
          <div class="row align-items-right">
            <div class="col-lg-12">

            <div class="events_card">
                <div class="row">
                <% @events.each do |event| %>
                  <div class="col-12 col-sm-4 mb-4 item <%=event.categories%> <%= event.online_event ? 'yes' : 'no' %>" data-end-date="<%= event.end_date %>">
                  <%# # for each row 3 cards 1 per vinly %>

                    <div class="bg-white rounded shadow h-100">
                      <a href="<%= event_path(event) %>" class="card-link text-decoration-none">
                        <div class="text-center">
                          <% if event.photo.attached? %>
                            <%= cl_image_tag event.photo.key, width: 400, height: 300, crop: :fill, class: "img-fluid card-img" %>
                          <% else %>
                            <%= image_tag("event_default.svg", class: "img-fluid card-img", style: "width:300px !important; height:300px !important;") %>
                          <% end %>
                        </div>
                        <div class="details-container d-flex">

                          <div>
                            <h3 style="font-weight: bold;"><%= event.title %></h3>
                            <h4 style="color: #aba9a9 !important; font-size: 18px;">  at <%= event.location %></h4>
                            <h4 style="color: #aba9a9 !important; font-size: 18px;"> <%= event.hashtags %></h4>
                            <h4 style="color: #aba9a9 !important; font-size: 18px;"> Posted 5 platforms (eventlistings ref)</h4>
                            <h4 style="color: #aba9a9 !important; font-size: 18px;"> Views: 246 (sum of all eventlistings views)</h4>
                          </div>
                        </div>
                      </a>

                    </div>

                  </div>
                  <% end %>
                </div>
              </div>
            </div>
          </div>
        </div>
         <script>
          $(document).ready(function () {
            // filter function
            (function () {
              let $events_card = $('.events_card');

              $events_card.isotope({
                itemSelector: '.item',
                layoutMode: 'fitRows',
              });

              // Handling category filter
              $('ul.filters.category > li').on('click', function (e) {
                e.preventDefault();

                let categoryFilter = $(this).attr('data-filter');

                $('ul.filters.category > li').removeClass('active');
                $(this).addClass('active');

                // Combine category and online/offline filters
                let onlineOfflineFilter = $('ul.filters.online-offline > li.active').attr('data-filter');
                let combinedFilter = categoryFilter + onlineOfflineFilter;

                $events_card.isotope({ filter: combinedFilter });
              });

              // Handling online/offline filter
              $('ul.filters.online-offline > li').on('click', function (e) {
                e.preventDefault();

                let onlineOfflineFilter = $(this).attr('data-filter');

                $('ul.filters.online-offline > li').removeClass('active');
                $(this).addClass('active');

                // Combine category and online/offline filters
                let categoryFilter = $('ul.filters.category > li.active').attr('data-filter');
                let combinedFilter = categoryFilter + onlineOfflineFilter;

                $events_card.isotope({ filter: combinedFilter });
              });

              // Show/hide past, upcoming, and all events
              $('#filter-upcoming').on('click', function () {
                $events_card.isotope({ filter: function () { return new Date($(this).data('end-date')) >= new Date(); } });
              });

              $('#filter-past').on('click', function () {
                $events_card.isotope({ filter: function () { return new Date($(this).data('end-date')) < new Date(); } });
              });

              $('#filter-all').on('click', function () {
                $events_card.isotope({ filter: '*' });
              });
            })();
          });
        </script>
    </div>
  </div>
</div>
